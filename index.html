<!DOCTYPE html>
<html>
<head>
<title>EEG Fatigue Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body style="background:#020617;color:white;text-align:center">

<h1>EEG Fatigue Monitoring</h1>
<h2 id="status">Waiting...</h2>
<div id="traffic" style="width:70px;height:70px;border-radius:50%;margin:auto"></div>

<audio id="alarm">
  <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg">
</audio>

<canvas id="bands"></canvas>
<canvas id="fatigue"></canvas>

<script>
const API="https://YOUR-BACKEND.onrender.com/latest";

const bandChart=new Chart(bands,{
 type:'line',
 data:{labels:[],datasets:[
  {label:'Alpha',data:[],borderColor:'cyan'},
  {label:'Beta',data:[],borderColor:'yellow'},
  {label:'Gamma',data:[],borderColor:'orange'},
  {label:'Delta',data:[],borderColor:'lime'}
 ]}
});

const fatChart=new Chart(fatigue,{
 type:'line',
 data:{labels:[],datasets:[{label:'Fatigue',data:[],borderColor:'red'}]},
 options:{scales:{y:{min:0,max:3}}}
});

setInterval(()=>{
 fetch(API).then(r=>r.json()).then(d=>{
  if(!d.time)return;

  bandChart.data.labels.push("");
  bandChart.data.datasets[0].data.push(d.alpha_rms);
  bandChart.data.datasets[1].data.push(d.beta_rms);
  bandChart.data.datasets[2].data.push(d.gamma_rms);
  bandChart.data.datasets[3].data.push(d.delta_rms);
  bandChart.update();

  fatChart.data.labels.push("");
  fatChart.data.datasets[0].data.push(d.prediction);
  fatChart.update();

  const t=["ACTIVE","INITIAL","HEAVY","UNCONSCIOUS"];
  const c=["green","yellow","orange","red"];

  status.innerText="STATUS: "+t[d.prediction];
  traffic.style.background=c[d.prediction];

  if(d.prediction==3){
    alarm.play();
    if(navigator.vibrate) navigator.vibrate([500,300,500]);
  }
 });
},1000);
</script>

</body>
</html>
